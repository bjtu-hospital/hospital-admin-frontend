# 系统配置接口说明

## 接口概览

系统配置接口用于管理医院管理系统的各项配置参数，包括挂号配置和排班配置。

**基础路径**: `/admin/config/`

---

## 1. 获取系统配置

### 接口信息
- **URL**: `/admin/config/`
- **方法**: `GET`
- **权限**: 需要管理员权限
- **描述**: 获取系统所有配置信息

### 请求参数
无

### 响应格式

**成功响应** (HTTP 200)
```json
{
  "code": 0,
  "message": {
    "registration": {
      "advanceBookingDays": 14,
      "sameDayDeadline": "08:00",
      "noShowLimit": 3,
      "cancelHoursBefore": 24,
      "sameClinicInterval": 7
    },
    "schedule": {
      "maxFutureDays": 60,
      "morningStart": "08:00",
      "morningEnd": "12:00",
      "afternoonStart": "14:00",
      "afternoonEnd": "18:00",
      "eveningStart": "18:30",
      "eveningEnd": "21:00",
      "consultationDuration": 15,
      "intervalTime": 5
    }
  }
}
```

**错误响应** (HTTP 400/500)
```json
{
  "code": 1,
  "message": "错误信息"
}
```

### 响应字段说明

#### registration (挂号配置)
| 字段名 | 类型 | 说明 | 范围 |
|--------|------|------|------|
| advanceBookingDays | number | 提前挂号天数 | 1-90 |
| sameDayDeadline | string | 当日挂号截止时间，格式: HH:mm | 例: "08:00" |
| noShowLimit | number | 爽约次数限制 | 1-10 |
| cancelHoursBefore | number | 退号提前时间（小时） | 1-72 |
| sameClinicInterval | number | 同科室挂号间隔（天） | 1-30 |

#### schedule (排班配置)
| 字段名 | 类型 | 说明 | 范围 |
|--------|------|------|------|
| maxFutureDays | number | 最多排未来天数 | 7-180 |
| morningStart | string | 上午班开始时间，格式: HH:mm | 例: "08:00" |
| morningEnd | string | 上午班结束时间，格式: HH:mm | 例: "12:00" |
| afternoonStart | string | 下午班开始时间，格式: HH:mm | 例: "14:00" |
| afternoonEnd | string | 下午班结束时间，格式: HH:mm | 例: "18:00" |
| eveningStart | string | 晚班开始时间，格式: HH:mm | 例: "18:30" |
| eveningEnd | string | 晚班结束时间，格式: HH:mm | 例: "21:00" |
| consultationDuration | number | 单次就诊时长（分钟） | 5-60 |
| intervalTime | number | 就诊间隔时间（分钟） | 0-30 |

---

## 2. 更新系统配置

### 接口信息
- **URL**: `/admin/config/`
- **方法**: `PUT`
- **权限**: 需要管理员权限
- **描述**: 更新系统配置信息

### 请求格式

**Content-Type**: `application/json`

```json
{
  "registration": {
    "advanceBookingDays": 14,
    "sameDayDeadline": "08:00",
    "noShowLimit": 3,
    "cancelHoursBefore": 24,
    "sameClinicInterval": 7
  },
  "schedule": {
    "maxFutureDays": 60,
    "morningStart": "08:00",
    "morningEnd": "12:00",
    "afternoonStart": "14:00",
    "afternoonEnd": "18:00",
    "eveningStart": "18:30",
    "eveningEnd": "21:00",
    "consultationDuration": 15,
    "intervalTime": 5
  }
}
```

### 请求参数说明

所有字段都是可选的，只需要传递需要更新的字段。字段说明和范围与获取接口相同。

### 数据验证规则

#### 数值范围验证
- `advanceBookingDays`: 1 ≤ value ≤ 90
- `noShowLimit`: 1 ≤ value ≤ 10
- `cancelHoursBefore`: 1 ≤ value ≤ 72
- `sameClinicInterval`: 1 ≤ value ≤ 30
- `maxFutureDays`: 7 ≤ value ≤ 180
- `consultationDuration`: 5 ≤ value ≤ 60
- `intervalTime`: 0 ≤ value ≤ 30

#### 时间格式验证
- 所有时间字段必须符合 HH:mm 格式 (24小时制)
- 例如: "08:00", "14:30", "23:59"

#### 逻辑验证
- 上午班: `morningStart < morningEnd`
- 下午班: `afternoonStart < afternoonEnd`
- 晚班: `eveningStart < eveningEnd`
- 班次之间应该有合理的间隔

### 响应格式

**成功响应** (HTTP 200)
```json
{
  "code": 0,
  "message": "success"
}
```

**验证失败** (HTTP 400)
```json
{
  "code": 1,
  "message": "具体的验证错误信息"
}
```

**服务器错误** (HTTP 500)
```json
{
  "code": 1,
  "message": "服务器内部错误"
}
```

---

## 错误码说明

| 错误码 | 说明 |
|--------|------|
| 0 | 成功 |
| 1 | 请求失败（包括验证失败、权限不足、服务器错误等） |

---

## 使用示例

### 获取配置
```javascript
// 使用 axios
const response = await axios.get('/admin/config/')
console.log(response.data.message.registration)
```

### 更新配置
```javascript
// 更新挂号配置
const response = await axios.put('/admin/config/', {
  registration: {
    advanceBookingDays: 30,
    noShowLimit: 5
  }
})
```

---

## 注意事项

1. **权限控制**: 所有接口都需要管理员权限，未授权请求会返回 401 错误
2. **数据验证**: 前端应该在提交前进行数据验证，避免不必要的请求
3. **并发更新**: 如果多个管理员同时修改配置，后提交的会覆盖先提交的
4. **配置生效**: 配置更新后立即生效，影响所有后续的挂号和排班操作
5. **日志记录**: 建议后端记录配置修改日志，包括修改人、修改时间和修改内容
6. **默认值**: 如果某些配置项未设置，系统应该使用合理的默认值

---

## 前端集成说明

### API 文件位置
`src/api/config.js`

### 主要函数
- `getSystemConfig()`: 获取系统配置
- `updateSystemConfig(config)`: 更新系统配置

### Mock 数据
开发环境可以通过设置 `USE_MOCK = true` 使用本地 Mock 数据，Mock 数据文件位于：
`src/views/rules/config-mock.js`

### 页面组件
配置页面组件位于：
`src/views/rules/Rules.vue`
